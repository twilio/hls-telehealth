(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[665],{2616:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/patient/video",function(){return n(7712)}])},855:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var o=n(7294),i=n(8847),r=n(1438),c=n(4155);function a(){var e,t=(0,o.useState)(r.DF),n=t[0],a=(t[1],{bandwidthProfile:{video:{mode:n.bandwidthProfileMode,dominantSpeakerPriority:n.dominantSpeakerPriority,trackSwitchOffMode:n.trackSwitchOffMode,contentPreferencesMode:n.contentPreferencesMode,clientTrackSwitchOffControl:n.clientTrackSwitchOffControl}},dominantSpeaker:!0,networkQuality:{local:1,remote:1},maxAudioBitrate:Number(n.maxAudioBitrate),preferredVideoCodecs:[{codec:"VP8",simulcast:"peer-to-peer"!==n.roomType&&"go"!==n.roomType}],environment:c.env.REACT_APP_TWILIO_ENVIRONMENT});return i.tq&&(null===a||void 0===a||null===(e=a.bandwidthProfile)||void 0===e?void 0:e.video)&&(a.bandwidthProfile.video.maxSubscriptionBitrate=25e5),"dev"===c.env.REACT_APP_TWILIO_ENVIRONMENT&&(a.wsServer="wss://us2.vss.dev.twilio.com/signaling"),(0,i.po)(a)}},9623:function(e,t,n){"use strict";var o=n(5893),i=n(7294),r=n(1582),c=n(5133),a=n(855),u=n(5428);function s(e){var t=(0,r.R)(),n=t.visit,c=t.user,a=(0,u.Z)(),s=a.getAudioAndVideoTracks,d=a.localTracks,f=(0,i.useState)(),l=f[0],v=f[1];return(0,i.useEffect)((function(){l||s().catch((function(e){console.log("Error acquiring local media:"),console.dir(e),v(e)}))}),[s,l]),n&&c&&d&&d.length>0&&(0,o.jsx)(o.Fragment,{children:e.children})}t.Z=function(e){var t=(0,a.Z)();return(0,o.jsx)(r.KX,{children:(0,o.jsx)(c.Z,{options:t,onError:function(e){return console.log(e)},children:(0,o.jsx)(s,{children:e.children})})})}},7712:function(e,t,n){"use strict";n.r(t);var o=n(5893),i=n(7294),r=n(5428),c=n(1117),a=n(1582),u=n(602),s=n(1163),d=n(9623),f=function(){var e=(0,a.R)(),t=e.user,n=e.visit,d=(0,r.Z)(),f=d.connect,l=d.room,v=(0,s.useRouter)();return(0,i.useEffect)((function(){l||u.G.checkRoom(t,n.roomName).then((function(e){e.roomAvailable||v.push("/patient/waiting-room"),f(e.token)}))}),[v,l]),(0,o.jsx)(c.ls,{})};f.Layout=d.Z,t.default=f},602:function(e,t,n){"use strict";n.d(t,{G:function(){return i}});var o={backendRoot:"",token:{get:"/visit/token",validate:"/token/validate"},visits:{list:"/visits",get:"/visits/{id}",patientRoomToken:"/visit/room",providerRoomToken:"/visit/provider-room"},get:function(e){return"".concat(o.backendRoot).concat(e)}};var i={checkRoom:function(e,t){return fetch(o.get(o.visits.patientRoomToken),{method:"POST",body:JSON.stringify({room_name:t}),headers:{authorization:"Bearer ".concat(e.token),Accept:"application/json","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){return e}))},createRoom:function(e,t){return fetch(o.get(o.visits.providerRoomToken),{method:"POST",body:JSON.stringify({room_name:t}),headers:{authorization:"Bearer ".concat(e.token),Accept:"application/json","Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){return e}))}}},1163:function(e,t,n){e.exports=n(387)}},function(e){e.O(0,[316,283,905,117,774,888,179],(function(){return t=2616,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
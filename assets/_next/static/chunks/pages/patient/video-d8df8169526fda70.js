(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[665],{62616:function(t,n,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/patient/video",function(){return e(47712)}])},855:function(t,n,e){"use strict";e.d(n,{Z:function(){return a}});var o=e(67294),i=e(48847),r=e(1438),c=e(34155);function a(){var t,n=(0,o.useState)(r.DF),e=n[0],a=(n[1],{bandwidthProfile:{video:{mode:e.bandwidthProfileMode,dominantSpeakerPriority:e.dominantSpeakerPriority,trackSwitchOffMode:e.trackSwitchOffMode,contentPreferencesMode:e.contentPreferencesMode,clientTrackSwitchOffControl:e.clientTrackSwitchOffControl}},dominantSpeaker:!0,networkQuality:{local:1,remote:1},maxAudioBitrate:Number(e.maxAudioBitrate),preferredVideoCodecs:[{codec:"VP8",simulcast:"peer-to-peer"!==e.roomType&&"go"!==e.roomType}],environment:c.env.REACT_APP_TWILIO_ENVIRONMENT});return i.tq&&(null===a||void 0===a||null===(t=a.bandwidthProfile)||void 0===t?void 0:t.video)&&(a.bandwidthProfile.video.maxSubscriptionBitrate=25e5),"dev"===c.env.REACT_APP_TWILIO_ENVIRONMENT&&(a.wsServer="wss://us2.vss.dev.twilio.com/signaling"),(0,i.po)(a)}},69623:function(t,n,e){"use strict";var o=e(85893),i=e(67294),r=e(51582),c=e(8225),a=e(95133),u=e(855),s=e(15428);function d(t){var n=(0,r.R)(),e=n.visit,c=n.user,a=(0,s.Z)(),u=a.getAudioAndVideoTracks,d=a.localTracks,f=(0,i.useState)(),l=f[0],v=f[1];return(0,i.useEffect)((function(){l||u().catch((function(t){console.log("Error acquiring local media:"),console.dir(t),v(t)}))}),[u,l]),e&&c&&d&&d.length>0&&(0,o.jsx)(o.Fragment,{children:t.children})}n.Z=function(t){var n=(0,u.Z)();return(0,o.jsx)(r.KX,{children:(0,o.jsx)(a.Z,{options:n,onError:function(t){return console.log(t)},children:(0,o.jsx)(d,{children:(0,o.jsx)(c.a,{children:t.children})})})})}},47712:function(t,n,e){"use strict";e.r(n);var o=e(85893),i=e(67294),r=e(15428),c=e(41117),a=e(51582),u=e(36539),s=e(11163),d=e(69623),f=e(610),l=function(){var t=(0,a.R)(),n=t.user,e=t.visit,d=(0,r.Z)(),l=d.connect,v=d.room,h=(0,f.Z)().connect,p=(0,s.useRouter)();return(0,i.useEffect)((function(){v||u.G.checkRoom(n,e.roomName).then((function(t){t.roomAvailable||p.push("/patient/waiting-room"),h(t.token),l(t.token)}))}),[p,v]),(0,o.jsx)(c.ls,{})};l.Layout=d.Z,n.default=l},43820:function(t,n,e){"use strict";e.d(n,{X:function(){return o}});var o={backendRoot:"http://localhost:3001",token:{get:"/visit/token",validate:"/token/validate"},visits:{list:"/visits",get:"/visits/{id}",token:"/visit/token",patientRoomToken:"/visit/room",providerRoomToken:"/visit/provider-room"},get:function(t){return"".concat(o.backendRoot).concat(t)}}},36539:function(t,n,e){"use strict";e.d(n,{G:function(){return i}});var o=e(43820);var i={checkRoom:function(t,n){return fetch(o.X.get(o.X.visits.patientRoomToken),{method:"POST",body:JSON.stringify({room_name:n}),headers:{authorization:"Bearer ".concat(t.token),Accept:"application/json","Content-Type":"application/json"}}).then((function(t){return t.json()})).then((function(t){return t}))},createRoom:function(t,n){return fetch(o.X.get(o.X.visits.providerRoomToken),{method:"POST",body:JSON.stringify({room_name:n}),headers:{authorization:"Bearer ".concat(t.token),Accept:"application/json","Content-Type":"application/json"}}).then((function(t){return t.json()})).then((function(t){return t}))}}},11163:function(t,n,e){t.exports=e(90387)}},function(t){t.O(0,[816,221,946,283,274,117,774,888,179],(function(){return n=62616,t(t.s=n);var n}));var n=t.O();_N_E=n}]);
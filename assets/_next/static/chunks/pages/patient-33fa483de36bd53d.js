(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[705],{4497:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/patient",function(){return n(14045)}])},1438:function(t,e,n){"use strict";n.d(e,{lA:function(){return r},J$:function(){return o},j4:function(){return i},p8:function(){return a},Do:function(){return c},sL:function(){return u},LX:function(){return s},bo:function(){return p},aE:function(){return d},DF:function(){return f}});var r={width:1280,height:720,frameRate:24},o="TwilioVideoApp-selectedAudioInput",i="TwilioVideoApp-selectedAudioOutput",a="TwilioVideoApp-selectedVideoInput",c="TwilioVideoApp-selectedBackgroundSettings",u="TelehealthUser",s="TelehealthVisit",p="CurrentVisitId",d="audio/*, image/*, text/*, video/*, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document .xslx, .ppt, .pdf, .key, .svg, .csv",f={trackSwitchOffMode:void 0,dominantSpeakerPriority:"standard",bandwidthProfileMode:"collaboration",maxAudioBitrate:"16000",contentPreferencesMode:"auto",clientTrackSwitchOffControl:"auto",roomType:"group"}},14045:function(t,e,n){"use strict";n.r(e);var r=n(35666),o=n.n(r),i=n(85893),a=n(11163),c=n(67294),u=n(93709),s=n(1107),p=n(51502),d=n(1438);function f(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(s){return void n(s)}c.done?e(u):Promise.resolve(u).then(r,o)}function l(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){f(i,r,o,a,c,"next",t)}function c(t){f(i,r,o,a,c,"throw",t)}a(void 0)}))}}e.default=function(){var t=(0,a.useRouter)();return(0,c.useEffect)((function(){var e=t.query.token;e&&u.Z.authenticateVisitorOrPatient(e).then((function(t){function e(){return(e=l(o().mark((function e(){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.Z.fetchTelehealthVisitForPatient(t,t.id);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return p.Z.saveToStorage(d.sL,t),function(){return e.apply(this,arguments)}()})).then((function(e){e&&(p.Z.saveToStorage(d.LX,e),t.push("/patient/waiting-room"))}))}),[t]),(0,i.jsx)("p",{children:"Please wait! You will be redirected to a call shortly."})}},93709:function(t,e,n){"use strict";function r(t){this.message=t}n.d(e,{Z:function(){return d}}),r.prototype=new Error,r.prototype.name="InvalidCharacterError";var o="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new r("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,o,i=0,a=0,c="";o=e.charAt(a++);~o&&(n=i%4?64*n+o:o,i++%4)?c+=String.fromCharCode(255&n>>(-2*i&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return c};function i(t){var e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(o(t).replace(/(.)/g,(function(t,e){var n=e.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(e)}catch(t){return o(e)}}function a(t){this.message=t}a.prototype=new Error,a.prototype.name="InvalidTokenError";var c=function(t,e){if("string"!=typeof t)throw new a("Invalid token specified");var n=!0===(e=e||{}).header?0:1;try{return JSON.parse(i(t.split(".")[n]))}catch(t){throw new a("Invalid token specified: "+t.message)}},u=n(43820);function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){s(t,e,n[e])}))}return t}var d={authenticateVisitorOrPatient:function(t){return fetch(u.X.get(u.X.visits.token),{method:"POST",body:JSON.stringify({action:"TOKEN",passcode:t}),headers:{Accept:"application/json","Content-Type":"application/json"}}).then((function(t){return t.json()})).then((function(t){var e=c(t.token);return p({},e,{isAuthenticated:!0,token:t.token,name:e.id})}))},authenticatePractitioner:function(t){return fetch(u.X.get(u.X.visits.token),{method:"POST",body:JSON.stringify({action:"TOKEN",passcode:t}),headers:{Accept:"application/json","Content-Type":"application/json"}}).then((function(t){return t.json()})).then((function(t){var e=c(t.token);return p({},e,{isAuthenticated:!0,token:t.token,name:e.id})}))}}},51502:function(t,e){"use strict";e.Z={getFromStorage:function(t,e){try{var n=window.localStorage.getItem(t);if(n){var r=JSON.parse(n);return Promise.resolve(r)}}catch(o){return console.log(o),Promise.resolve(e)}},saveToStorage:function(t,e){return null==e?window.localStorage.removeItem(t):window.localStorage.setItem(t,JSON.stringify(e)),Promise.resolve()}}},43820:function(t,e,n){"use strict";n.d(e,{X:function(){return r}});var r={backendRoot:"",token:{get:"/visit/token",validate:"/token/validate"},visits:{list:"/visits",get:"/visits/{id}",token:"/visit/token",invite:"/visit/invite",patientRoomToken:"/visit/room",providerRoomToken:"/visit/provider-room",recording:"/visit/recording"},sms:"/send-sms",get:function(t){return"".concat(r.backendRoot).concat(t)}}},1107:function(t,e,n){"use strict";var r=n(35666),o=n.n(r),i=n(43820);function a(t,e,n,r,o,i,a){try{var c=t[i](a),u=c.value}catch(s){return void n(s)}c.done?e(u):Promise.resolve(u).then(r,o)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function c(t){a(i,r,o,c,u,"next",t)}function u(t){a(i,r,o,c,u,"throw",t)}c(void 0)}))}}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){u(t,e,n[e])}))}return t}function p(t){t.patient_medications.map((function(t){return{medication:t}}));return s({id:t.patient_id,name:t.patient_name,family_name:t.patient_family_name,given_name:t.patient_given_name,phone:t.patient_phone},t.patient_email&&{email:t.patient_email},{gender:t.patient_gender},t.patient_language&&{language:t.patient_language},{medications:t.patient_medications,conditions:t.patient_conditions})}function d(t){return{id:t.provider_id,name:t.provider_name,phone:t.provider_phone,on_call:new Boolean(t.provider_on_call)}}function f(t){return s({id:t.appointment_id,type:t.appointment_type,start_datetime_ltz:new Date(t.appointment_start_datetime_utc),end_datetime_ltz:new Date(t.appointment_end_datetime_utc)},t.appointment_reason&&{reason:t.appointment_reason},{references:t.appointment_references,patient_id:t.patient_id,provider_id:t.provider_id})}function l(t){return s({id:t.content_id,title:t.content_title},t.content_description&&{description:t.content_description},{video_url:t.content_video_url,provider_ids:t.providers.map((function(t){return t}))})}function h(){return(h=c(o().mark((function t(e){var n,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"provider"!==e.role&&Promise.reject({error:"Only provider can get patient queue"}),t.next=3,fetch(i.X.backendRoot+"/datastore/appointments",{method:"POST",body:JSON.stringify({action:"GETTUPLE",provider_id:e.id}),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)}}).then((function(t){return t.json()}));case 3:return n=t.sent,r=[],n.forEach((function(t){var e=p(t.patient),n=d(t.provider),o=f(t.appointment),i={id:o.id,roomName:o.id,ehrAppointment:o,ehrPatient:e,ehrProvider:n};r.push(i),console.log(i)})),t.abrupt("return",Promise.resolve(r));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function v(){return(v=c(o().mark((function t(e,n){var r,a,c,u,s;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(i.X.backendRoot+"/datastore/appointments",{method:"POST",body:JSON.stringify({action:"GETTUPLE",appointment_id:n}),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)}}).then((function(t){return t.json()}));case 2:return 0===(r=t.sent).length&&Promise.reject({error:"not found appointment: ".concat(n)}),a=p(r[0].patient),c=d(r[0].provider),u=f(r[0].appointment),s={id:u.id,roomName:u.id,ehrAppointment:u,ehrPatient:a,ehrProvider:c},t.abrupt("return",Promise.resolve(s));case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function m(){return(m=c(o().mark((function t(e){var n,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(i.X.backendRoot+"/datastore/contents",{method:"POST",body:JSON.stringify({action:"GET"}),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)}}).then((function(t){return t.json()}));case 2:return n=t.sent,r=[],n.forEach((function(t){var e=l(n[0]);r.push(e)})),t.abrupt("return",Promise.resolve(r));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(){return(g=c(o().mark((function t(e){var n,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(i.X.backendRoot+"/datastore/contents",{method:"POST",body:JSON.stringify({action:"GET",provider_id:e.id}),headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(e.token)}}).then((function(t){return t.json()}));case 2:return 0===(n=t.sent).length&&Promise.reject({error:"not found any content"}),r=l(n[0]),t.abrupt("return",Promise.resolve(r));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}e.Z={fetchAllTelehealthVisits:function(t){return h.apply(this,arguments)},fetchTelehealthVisitForPatient:function(t,e){return v.apply(this,arguments)},fetchAllContent:function(t){return m.apply(this,arguments)},fetchContentForProvider:function(t){return g.apply(this,arguments)}}},11163:function(t,e,n){t.exports=n(90387)}},function(t){t.O(0,[774,888,179],(function(){return e=4497,t(t.s=e);var e}));var e=t.O();_N_E=e}]);